<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>å®å®å¥¶é‡è®¡ç®—å™¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // é…ç½®Tailwindè‡ªå®šä¹‰é¢œè‰²å’Œå­—ä½“
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF9EAA', // ç²‰è‰²ä¸»è‰²è°ƒï¼Œé€‚åˆå©´å„¿
                        secondary: '#81C784', // ç»¿è‰²è¾…åŠ©è‰²
                        accent: '#4FC3F7', // è“è‰²å¼ºè°ƒè‰²
                        neutral: '#FFF8E1', // ç±³è‰²èƒŒæ™¯
                    },
                    fontFamily: {
                        bubble: ['Comic Sans MS', 'cursive', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
            }
            .bg-pattern {
                background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50 50C50 27.9 72.1 6 100 6V94C72.1 94 50 72.1 50 50Z' fill='%23FFD7DA' fill-opacity='0.3'/%3E%3Cpath d='M0 50C0 27.9 22.1 6 50 6V94C22.1 94 0 72.1 0 50Z' fill='%23A5D6A7' fill-opacity='0.3'/%3E%3C/svg%3E");
            }
            .bottle-shadow {
                filter: drop-shadow(0 4px 3px rgb(0 0 0 / 0.07)) drop-shadow(0 2px 2px rgb(0 0 0 / 0.06));
            }
            .btn-bounce:hover {
                transform: translateY(-3px);
            }
            .btn-bounce:active {
                transform: translateY(0);
            }
        }
    </style>
</head>
<body class="bg-neutral bg-pattern min-h-screen font-bubble text-gray-800">
    <!-- é¡¶éƒ¨è£…é¥° -->
    <div class="absolute top-0 left-0 right-0 h-4 bg-primary rounded-b-full"></div>
    
    <!-- ä¸»å®¹å™¨ -->
    <div class="container mx-auto px-4 pt-10 pb-6 max-w-md min-h-[90vh] flex flex-col">
        <!-- å¤´éƒ¨ -->
        <header class="text-center mb-4">
            <h1 class="text-[clamp(1.5rem,4vw,2rem)] font-bold text-primary text-shadow">
                ğŸ¼ å®å®å¥¶é‡è®¡ç®—å™¨ ğŸ¼
            </h1>
            <p class="text-gray-600 text-sm mt-1">è½»æ¾è®¡ç®—å®å®å®é™…å–å¥¶é‡</p>
        </header>

        <!-- å¥¶ç“¶å¡é€šå›¾æ ‡ - å‡å°å°ºå¯¸ -->
        <div class="flex justify-center mb-4">
            <div class="relative bottle-shadow">
                <div class="w-28 h-48 bg-white rounded-t-full border-4 border-gray-300 overflow-hidden">
                    <div id="milk-level" class="absolute bottom-0 left-0 right-0 h-36 bg-primary/70 transition-all duration-500"></div>
                    <div class="absolute top-2 left-1/2 transform -translate-x-1/2 w-16 h-5 bg-white border-4 border-gray-300 rounded-full"></div>
                </div>
                <div class="absolute -bottom-2 left-1/2 transform -translate-x-1/2 w-16 h-2 bg-gray-300 rounded-full"></div>
            </div>
        </div>

        <!-- ä¸»è¦å†…å®¹ - ç´§å‡‘å¸ƒå±€ -->
        <main class="bg-white rounded-3xl p-4 shadow-lg border-2 border-primary/30 flex-grow">
            <!-- æ­¥éª¤1ï¼šé€‰æ‹©æ°´çš„ä½“ç§¯ -->
            <section class="mb-4">
                <h2 class="text-lg font-bold text-primary mb-2 flex items-center">
                    ğŸ’§ æ­¥éª¤1ï¼šé€‰æ‹©æ°´çš„ä½“ç§¯
                </h2>
                <div class="bg-neutral/70 p-3 rounded-2xl">
                    <label for="water-volume" class="block mb-1 text-gray-700 text-sm">æ°´çš„ä½“ç§¯ (ml):</label>
                    <select id="water-volume" class="w-full p-2 rounded-xl border-2 border-primary/50 bg-white text-gray-800 focus:outline-none focus:border-primary transition-all text-base">
                        <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </select>
                    <p class="text-xs text-gray-500 mt-1 italic">æç¤ºï¼šè¯·é€‰æ‹©30-210mlä¹‹é—´çš„æ°´é‡ï¼Œå¿…é¡»æ˜¯30çš„å€æ•°</p>
                </div>
            </section>

            <!-- æ­¥éª¤2ï¼šæ˜¾ç¤ºå†²æ³¡åçš„æ€»é‡é‡ -->
            <section class="mb-4 hidden" id="total-weight-section">
                <h2 class="text-lg font-bold text-secondary mb-2 flex items-center">
                    âš–ï¸ å†²æ³¡åæ€»é‡é‡
                </h2>
                <div class="bg-neutral/70 p-3 rounded-2xl text-center">
                    <p class="text-base">å†²æ³¡åçš„å¥¶ç“¶æ€»é‡ï¼š</p>
                    <p id="total-weight" class="text-2xl font-bold text-secondary mt-1">0 g</p>
                    <p class="text-xs text-gray-600 mt-1">åŒ…å«ï¼šæ°´ + å¥¶ç²‰ + ç©ºç“¶</p>
                </div>
            </section>

            <!-- æ­¥éª¤3ï¼šè¾“å…¥å‰©ä½™é‡é‡å¹¶è®¡ç®— -->
            <section class="mb-4 hidden" id="calculate-section">
                <h2 class="text-lg font-bold text-accent mb-2 flex items-center">
                    ğŸ”¢ æ­¥éª¤3ï¼šè®¡ç®—å–å¥¶é‡
                </h2>
                <div class="bg-neutral/70 p-3 rounded-2xl">
                    <label for="remaining-weight" class="block mb-1 text-gray-700 text-sm">å–å®Œåå‰©ä½™é‡é‡ (g):</label>
                    <input type="number" id="remaining-weight" min="175" class="w-full p-2 rounded-xl border-2 border-accent/50 bg-white text-gray-800 focus:outline-none focus:border-accent transition-all text-base" placeholder="è¯·è¾“å…¥é‡é‡">
                    <p class="text-xs text-gray-500 mt-1 italic">æç¤ºï¼šç©ºç“¶é‡é‡ä¸º175gï¼Œè¾“å…¥å€¼ä¸èƒ½å°äºæ­¤æ•°</p>
                </div>
                <button id="calculate-btn" class="w-full mt-3 py-2.5 bg-accent text-white font-bold rounded-xl shadow-md transition-all btn-bounce flex items-center justify-center text-base">
                    ğŸ”¢ è®¡ç®—å®å®å–å¥¶é‡
                </button>
            </section>

            <!-- ç»“æœæ˜¾ç¤º -->
            <section class="mb-2 hidden" id="result-section">
                <div class="bg-secondary/20 p-3 rounded-2xl border-2 border-secondary/30">
                    <h2 class="text-lg font-bold text-secondary mb-2 text-center">è®¡ç®—ç»“æœ</h2>
                    <div class="grid grid-cols-2 gap-2">
                        <div class="text-center">
                            <p class="text-xs text-gray-600">å–æ‰çš„é‡é‡</p>
                            <p id="drank-weight" class="text-xl font-bold text-gray-800">0 g</p>
                        </div>
                        <div class="text-center">
                            <p class="text-xs text-gray-600">å–æ‰çš„ä½“ç§¯</p>
                            <p id="drank-volume" class="text-xl font-bold text-secondary">0 ml</p>
                        </div>
                    </div>
                    <div class="mt-3 text-center">
                        <p class="text-sm text-gray-700">ç›¸å½“äºæ·»åŠ äº†çº¦</p>
                        <p id="scoops-count" class="text-xl font-bold text-accent">0</p>
                        <p class="text-xs text-gray-700">å‹ºå¥¶ç²‰å†²æ³¡çš„å¥¶é‡</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- åº•éƒ¨ä¿¡æ¯ - ç²¾ç®€æ˜¾ç¤º -->
        <footer class="text-center mt-4 text-gray-500 text-xs">
            <p>ğŸ’– ä¸ºå®å®å¥åº·æˆé•¿ç²¾å¿ƒè®¾è®¡ ğŸ’–</p>
        </footer>
    </div>

    <script>
        // å¸¸é‡å®šä¹‰
        const EMPTY_BOTTLE_WEIGHT = 175; // ç©ºç“¶å­é‡é‡(g)
        const MILK_POWDER_PER_SCOOP = 5; // ä¸€å‹ºå¥¶ç²‰é‡é‡(g)
        const WATER_PER_SCOOP = 30; // æ¯å‹ºå¥¶ç²‰å¯¹åº”æ°´é‡(ml)
        const WATER_TO_MILK_RATIO = 90 / 100; // æ°´ä¸å¥¶çš„ä½“ç§¯æ¯”ä¾‹

        // DOM å…ƒç´ 
        const waterVolumeSelect = document.getElementById('water-volume');
        const totalWeightSection = document.getElementById('total-weight-section');
        const totalWeightDisplay = document.getElementById('total-weight');
        const calculateSection = document.getElementById('calculate-section');
        const remainingWeightInput = document.getElementById('remaining-weight');
        const calculateBtn = document.getElementById('calculate-btn');
        const resultSection = document.getElementById('result-section');
        const drankWeightDisplay = document.getElementById('drank-weight');
        const drankVolumeDisplay = document.getElementById('drank-volume');
        const scoopsCountDisplay = document.getElementById('scoops-count');
        const milkLevelElement = document.getElementById('milk-level');

        // åˆå§‹åŒ–é¡µé¢
        function init() {
            // ç”Ÿæˆæ°´ä½“ç§¯é€‰é¡¹
            generateWaterVolumeOptions();
            
            // å°è¯•åŠ è½½ç¼“å­˜çš„è®¾ç½®
            loadCachedSettings();
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            waterVolumeSelect.addEventListener('change', handleWaterVolumeChange);
            calculateBtn.addEventListener('click', calculateMilkConsumption);
        }

        // ç”Ÿæˆæ°´ä½“ç§¯é€‰é¡¹
        function generateWaterVolumeOptions() {
            for (let volume = 30; volume <= 210; volume += 30) {
                const option = document.createElement('option');
                option.value = volume;
                option.textContent = `${volume} ml`;
                waterVolumeSelect.appendChild(option);
            }
        }

        // åŠ è½½ç¼“å­˜çš„è®¾ç½®
        function loadCachedSettings() {
            const cachedVolume = localStorage.getItem('lastWaterVolume');
            if (cachedVolume) {
                waterVolumeSelect.value = cachedVolume;
                handleWaterVolumeChange();
            }
        }

        // å¤„ç†æ°´ä½“ç§¯å˜åŒ–
        function handleWaterVolumeChange() {
            const waterVolume = parseInt(waterVolumeSelect.value);
            
            // ä¿å­˜åˆ°æœ¬åœ°ç¼“å­˜
            localStorage.setItem('lastWaterVolume', waterVolume);
            
            // è®¡ç®—å¹¶æ˜¾ç¤ºæ€»é‡é‡
            const totalWeight = calculateTotalWeight(waterVolume);
            totalWeightDisplay.textContent = `${totalWeight} g`;
            
            // æ˜¾ç¤ºç›¸å…³éƒ¨åˆ†
            totalWeightSection.classList.remove('hidden');
            calculateSection.classList.remove('hidden');
            
            // æ›´æ–°å¥¶ç“¶åŠ¨ç”»
            updateMilkLevel(waterVolume);
        }

        // è®¡ç®—æ€»é‡é‡
        function calculateTotalWeight(waterVolume) {
            // è®¡ç®—å¥¶ç²‰å‹ºæ•°
            const scoops = waterVolume / WATER_PER_SCOOP;
            // è®¡ç®—å¥¶ç²‰æ€»é‡é‡
            const milkPowderWeight = scoops * MILK_POWDER_PER_SCOOP;
            // æ°´çš„é‡é‡ (å‡è®¾æ°´çš„å¯†åº¦ä¸º1g/ml)
            const waterWeight = waterVolume;
            // æ€»é‡é‡
            return EMPTY_BOTTLE_WEIGHT + waterWeight + milkPowderWeight;
        }

        // æ›´æ–°å¥¶ç“¶åŠ¨ç”»
        function updateMilkLevel(waterVolume) {
            // è®¡ç®—å¥¶é‡å æ¯” (åŸºäºæœ€å¤§210mlæ°´å¯¹åº”çº¦233mlå¥¶)
            const maxMilkLevel = 233; // 210mlæ°´å¯¹åº”çº¦233mlå¥¶
            const milkVolume = waterVolume / WATER_TO_MILK_RATIO;
            const levelPercentage = (milkVolume / maxMilkLevel) * 100;
            
            milkLevelElement.style.height = `${levelPercentage}%`;
        }

        // è®¡ç®—å®å®å–å¥¶é‡
        function calculateMilkConsumption() {
            const waterVolume = parseInt(waterVolumeSelect.value);
            const remainingWeight = parseInt(remainingWeightInput.value);
            
            // éªŒè¯è¾“å…¥
            if (isNaN(remainingWeight) || remainingWeight < EMPTY_BOTTLE_WEIGHT) {
                alert('è¯·è¾“å…¥æœ‰æ•ˆçš„å‰©ä½™é‡é‡ï¼Œä¸èƒ½å°äºç©ºç“¶é‡é‡175g');
                return;
            }
            
            // è®¡ç®—æ€»é‡é‡
            const totalWeight = calculateTotalWeight(waterVolume);
            
            // è®¡ç®—å–æ‰çš„é‡é‡
            const drankWeight = totalWeight - remainingWeight;
            
            // è®¡ç®—å–æ‰çš„ä½“ç§¯ (æ ¹æ®90mlæ°´=100mlå¥¶çš„æ¯”ä¾‹)
            // é¦–å…ˆè®¡ç®—æ€»å¥¶é‡
            const totalMilkVolume = waterVolume / WATER_TO_MILK_RATIO;
            // è®¡ç®—æ€»å¥¶é‡ (æ€»é‡é‡ - ç©ºç“¶é‡é‡)
            const totalMilkWeight = totalWeight - EMPTY_BOTTLE_WEIGHT;
            // æ ¹æ®æ¯”ä¾‹è®¡ç®—å–æ‰çš„ä½“ç§¯
            const drankVolume = Math.round((drankWeight / totalMilkWeight) * totalMilkVolume);
            
            // è®¡ç®—equivalentå¤šå°‘å‹ºå¥¶ç²‰çš„é‡
            const totalScoops = waterVolume / WATER_PER_SCOOP;
            const drankScoops = Math.round((drankVolume / totalMilkVolume) * totalScoops * 10) / 10;
            
            // æ˜¾ç¤ºç»“æœ
            drankWeightDisplay.textContent = `${drankWeight} g`;
            drankVolumeDisplay.textContent = `${drankVolume} ml`;
            scoopsCountDisplay.textContent = `${drankScoops}`;
            
            resultSection.classList.remove('hidden');
            
            // ç¡®ä¿ç»“æœåœ¨å¯è§åŒºåŸŸå†…
            resultSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>